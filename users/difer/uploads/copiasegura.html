<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether Cloud Pro - Enterprise Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --bg-main: #050505;
            --bg-panel: #0a0a0a;
            --bg-card: #111111;
            --border-color: #1f1f1f;
            --accent: #3b82f6;
            --text-main: #f4f4f5;
            --text-muted: #71717a;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--text-main);
            overflow: hidden;
            user-select: none;
        }

        /* Scrollbar Profesional */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #3f3f46; }

        /* Efectos de Interfaz */
        .glass { background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(12px); border: 1px solid var(--border-color); }
        .pro-sidebar { background-color: var(--bg-panel); border-right: 1px solid var(--border-color); }
        
        /* Listado de Archivos Estilo Tabla */
        .file-row {
            display: grid;
            grid-template-cols: 3rem 2fr 1fr 1.2fr 120px;
            align-items: center;
            padding: 0.85rem 1.5rem;
            border-bottom: 1px solid #141414;
            transition: all 0.1s ease;
            cursor: pointer;
        }

        .file-row:hover { background-color: rgba(255,255,255,0.03); }
        .file-row.selected { background-color: rgba(59, 130, 246, 0.08); border-left: 3px solid var(--accent); }

        /* Context Menu Superior */
        #context-menu {
            position: fixed;
            z-index: 1000;
            background: #18181b;
            border: 1px solid #27272a;
            border-radius: 12px;
            padding: 6px;
            min-width: 220px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            display: none;
            animation: menuAppear 0.15s ease-out;
        }
        @keyframes menuAppear { 
            from { opacity: 0; transform: scale(0.95) translateY(-10px); } 
            to { opacity: 1; transform: scale(1) translateY(0); } 
        }

        .menu-item {
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            font-size: 13px;
            color: #d4d4d8;
            border-radius: 8px;
            transition: 0.2s;
        }
        .menu-item:hover { background: var(--accent); color: white; }
        .menu-item.danger:hover { background: #7f1d1d; color: #fecaca; }

        /* Loader */
        .loader-line {
            height: 2px; width: 100%; position: fixed; top: 0; left: 0; z-index: 2000;
            background: linear-gradient(to right, transparent, var(--accent), transparent);
            animation: loading 1.5s infinite;
            display: none;
        }
        @keyframes loading { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        /* Drag and Drop Visual Feedback */
        .drag-over { background-color: rgba(59, 130, 246, 0.05) !important; border: 2px dashed var(--accent) !important; }

        /* Auth Screen */
        .auth-tab.active { color: white; border-bottom: 2px solid var(--accent); }
    </style>
</head>
<body class="flex h-screen">

    <div id="loader" class="loader-line"></div>

    <!-- PANTALLA DE AUTENTICACIÓN -->
    <div id="auth-screen" class="fixed inset-0 z-[100] bg-black flex items-center justify-center p-6 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-zinc-900 via-black to-black">
        <div class="w-full max-w-md">
            <div class="text-center mb-10">
                <div class="w-20 h-20 bg-blue-600 rounded-[2rem] flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-blue-500/20">
                    <i class="fas fa-terminal text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-black tracking-tighter">AETHER CLOUD</h1>
                <p class="text-zinc-500 text-[10px] mt-1 uppercase tracking-[0.3em] font-black">Secure Binary Vault</p>
            </div>

            <div class="glass p-8 rounded-3xl shadow-2xl">
                <div class="flex gap-8 mb-8 border-b border-zinc-800">
                    <button onclick="switchAuth('login')" id="tab-login" class="auth-tab active pb-4 text-xs font-black transition-all tracking-widest">LOGIN</button>
                    <button onclick="switchAuth('register')" id="tab-register" class="auth-tab pb-4 text-xs font-black text-zinc-600 transition-all tracking-widest uppercase">Registro</button>
                </div>

                <div class="space-y-4">
                    <div class="group">
                        <label class="text-[9px] font-black text-zinc-500 uppercase ml-1 tracking-widest">Identificador</label>
                        <input type="text" id="auth-user" class="w-full bg-zinc-900/50 border border-zinc-800 p-4 rounded-xl outline-none focus:border-blue-500 transition-all text-sm mt-1" placeholder="admin_user">
                    </div>
                    <div class="group">
                        <label class="text-[9px] font-black text-zinc-500 uppercase ml-1 tracking-widest">Token de Acceso</label>
                        <input type="password" id="auth-pass" class="w-full bg-zinc-900/50 border border-zinc-800 p-4 rounded-xl outline-none focus:border-blue-500 transition-all text-sm mt-1" placeholder="••••••••">
                    </div>
                    
                    <button onclick="submitAuth()" id="auth-btn" class="w-full bg-blue-600 text-white font-black py-4 rounded-xl hover:bg-blue-500 transition-all active:scale-[0.98] shadow-lg shadow-blue-600/20 mt-4 text-xs tracking-widest uppercase">
                        Acceder al Sistema
                    </button>
                    
                    <p id="auth-msg" class="text-center text-[10px] font-bold uppercase tracking-tighter min-h-[1.2rem]"></p>
                </div>
            </div>
            <p class="text-center text-zinc-700 text-[9px] mt-10 font-black uppercase tracking-[0.4em]">© 2026 Enterprise Security Systems</p>
        </div>
    </div>

    <!-- BARRA LATERAL (SIDEBAR) -->
    <aside class="pro-sidebar w-72 flex flex-col hidden lg:flex">
        <div class="p-8">
            <div class="flex items-center gap-3 mb-10">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-600/20">
                    <i class="fas fa-cube text-white text-xs"></i>
                </div>
                <span class="font-black tracking-tighter text-xl">AETHER</span>
            </div>

            <nav class="space-y-1">
                <div class="text-[9px] font-black text-zinc-600 uppercase mb-4 tracking-widest ml-2">Explorador</div>
                <button onclick="setView('files')" id="nav-files" class="w-full flex items-center justify-between px-4 py-3 text-sm rounded-xl bg-blue-600/10 text-blue-400 font-bold group">
                    <span class="flex items-center gap-3"><i class="fas fa-hdd opacity-50 group-hover:opacity-100 transition-opacity"></i> Mi Unidad</span>
                    <span id="badge-files" class="text-[10px] opacity-40">0</span>
                </button>
                <button onclick="setView('trash')" id="nav-trash" class="w-full flex items-center justify-between px-4 py-3 text-sm rounded-xl text-zinc-500 hover:bg-white/5 font-medium transition-all">
                    <span class="flex items-center gap-3"><i class="fas fa-trash-alt"></i> Papelera</span>
                    <span id="badge-trash" class="text-[10px] opacity-40">0</span>
                </button>
            </nav>

            <div class="mt-10">
                <div class="text-[9px] font-black text-zinc-600 uppercase mb-4 tracking-widest ml-2">Etiquetas</div>
                <div class="flex flex-wrap gap-2 px-2">
                    <span class="w-3 h-3 rounded-full bg-red-500 cursor-pointer hover:scale-125 transition-transform"></span>
                    <span class="w-3 h-3 rounded-full bg-amber-500 cursor-pointer hover:scale-125 transition-transform"></span>
                    <span class="w-3 h-3 rounded-full bg-emerald-500 cursor-pointer hover:scale-125 transition-transform"></span>
                    <span class="w-3 h-3 rounded-full bg-blue-500 cursor-pointer hover:scale-125 transition-transform"></span>
                </div>
            </div>
        </div>

        <div class="mt-auto p-8 border-t border-zinc-900 bg-black/20">
            <div class="mb-6">
                <div class="flex justify-between text-[9px] font-black text-zinc-500 mb-2 uppercase tracking-tighter">
                    <span>Espacio en Repositorio</span>
                    <span id="storage-text">0%</span>
                </div>
                <div class="h-1.5 bg-zinc-900 rounded-full overflow-hidden">
                    <div id="storage-bar" class="h-full bg-blue-600 transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div id="user-avatar" class="w-10 h-10 rounded-xl bg-zinc-800 border border-zinc-700 flex items-center justify-center font-black text-xs text-zinc-400">?</div>
                <div class="flex-1 overflow-hidden">
                    <p id="user-name" class="text-xs font-bold truncate text-zinc-200">Invitado</p>
                    <p class="text-[9px] text-zinc-600 font-black uppercase tracking-tighter">Enterprise Tier</p>
                </div>
                <button onclick="logout()" class="text-zinc-700 hover:text-red-500 transition-colors p-2"><i class="fas fa-power-off"></i></button>
            </div>
        </div>
    </aside>

    <!-- PANEL PRINCIPAL -->
    <main class="flex-1 flex flex-col min-w-0 relative">
        <!-- Encabezado -->
        <header class="h-16 px-8 flex items-center justify-between border-b border-zinc-900 bg-black/40 backdrop-blur-md sticky top-0 z-20">
            <div id="breadcrumb" class="flex items-center gap-3 text-[10px] font-black text-zinc-500 uppercase tracking-widest">
                <i class="fab fa-github text-blue-500 text-sm"></i> / <span class="hover:text-white cursor-pointer transition-colors" onclick="loadFiles('')">ROOT</span>
            </div>
            
            <div class="flex items-center gap-6">
                <div class="relative hidden md:block">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-zinc-600 text-[10px]"></i>
                    <input type="text" id="file-search" oninput="filterFiles()" placeholder="BUSCAR ARCHIVOS..." class="bg-zinc-900/50 border border-zinc-800 rounded-lg pl-9 pr-4 py-2 text-[10px] font-bold outline-none focus:border-blue-500 w-64 transition-all">
                </div>
                <button onclick="document.getElementById('file-upload').click()" class="bg-zinc-100 text-black text-[10px] font-black px-5 py-2 rounded-lg hover:bg-white transition-all shadow-xl shadow-white/5 active:scale-95">
                    SUBIR ARCHIVOS
                </button>
            </div>
        </header>

        <!-- Contenido -->
        <div class="flex-1 p-8 flex flex-col overflow-hidden">
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 id="view-title" class="text-4xl font-black tracking-tighter">Mi Unidad</h2>
                    <p id="view-desc" class="text-zinc-600 text-xs mt-1 font-medium">Sincronizado con repositorio de GitHub en tiempo real.</p>
                </div>
                
                <div id="selection-toolbar" class="hidden flex items-center gap-3 animate-fade-in">
                    <span id="selection-count" class="text-[10px] font-black text-blue-500 uppercase mr-4">0 seleccionados</span>
                    <button onclick="execBulk('download')" class="p-2 text-zinc-400 hover:text-white" title="Descargar"><i class="fas fa-download"></i></button>
                    <button onclick="execBulk('delete')" class="p-2 text-red-500/50 hover:text-red-500" title="Eliminar"><i class="fas fa-trash"></i></button>
                    <div class="w-[1px] h-4 bg-zinc-800 mx-2"></div>
                    <button onclick="clearSelection()" class="text-zinc-500 text-[10px] font-black uppercase tracking-widest hover:text-white">Cancelar</button>
                </div>
                <button id="btn-empty-trash" onclick="emptyTrash()" class="hidden bg-red-600 text-white text-[10px] font-black px-4 py-2 rounded-lg hover:bg-red-500 shadow-lg shadow-red-600/10">VACIAR PAPELERA</button>
            </div>

            <!-- Área de Exploración (Drop Zone) -->
            <div id="drop-zone" class="flex-1 glass rounded-3xl flex flex-col overflow-hidden shadow-2xl relative">
                <!-- Header de Tabla -->
                <div class="file-row text-[9px] font-black uppercase text-zinc-600 tracking-[0.2em] border-b border-zinc-900 bg-zinc-900/20 sticky top-0 z-10">
                    <div class="flex justify-center">
                        <input type="checkbox" id="master-checkbox" onclick="toggleAllSelection()" class="rounded bg-zinc-800 border-zinc-700 text-blue-600 focus:ring-0 w-3 h-3">
                    </div>
                    <div>Nombre del Archivo</div>
                    <div>Tamaño</div>
                    <div>Última Edición</div>
                    <div class="text-right">Acciones</div>
                </div>

                <!-- Lista de Archivos -->
                <div id="file-list" class="flex-1 overflow-y-auto custom-scroll min-h-[400px]">
                    <!-- Render dinámico aquí -->
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="hidden absolute inset-0 flex flex-col items-center justify-center opacity-10 pointer-events-none">
                    <i class="fas fa-folder-open text-9xl mb-6"></i>
                    <p class="text-xl font-black uppercase tracking-widest">Bóveda Vacía</p>
                </div>
            </div>
        </div>
    </main>

    <!-- MENU CONTEXTUAL -->
    <div id="context-menu">
        <div id="ctx-file-group">
            <div class="menu-item" onclick="execAction('download')"><i class="fas fa-cloud-download-alt text-blue-500"></i> Descargar</div>
            <div class="menu-item" onclick="execAction('rename')"><i class="fas fa-edit text-zinc-400"></i> Renombrar</div>
            <div class="menu-item" onclick="execAction('copy-link')"><i class="fas fa-link text-zinc-400"></i> Copiar Enlace Directo</div>
            <div class="h-[1px] bg-zinc-800/50 my-1 mx-2"></div>
            <div class="menu-item danger" onclick="execAction('delete')"><i class="fas fa-trash-alt"></i> Mover a Papelera</div>
        </div>
        <div id="ctx-global-group" class="hidden">
            <div class="menu-item" onclick="createNewFolder()"><i class="fas fa-folder-plus text-amber-500"></i> Nueva Carpeta</div>
            <div class="menu-item" onclick="document.getElementById('file-upload').click()"><i class="fas fa-upload text-blue-500"></i> Cargar Archivos</div>
            <div class="menu-item" onclick="refresh()"><i class="fas fa-sync-alt text-emerald-500"></i> Actualizar Repositorio</div>
        </div>
    </div>

    <!-- INPUTS OCULTOS -->
    <input type="file" id="file-upload" class="hidden" multiple onchange="handleFileUpload(this.files)">

    <script>
        const API = 'api.php';
        let currentPath = '';
        let currentView = 'files';
        let authMode = 'login';
        let allFiles = [];
        let selectedFiles = new Set();
        let contextTarget = null;

        // --- AUTENTICACIÓN ---
        function switchAuth(mode) {
            authMode = mode;
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active', 'text-white'));
            document.getElementById(`tab-${mode}`).classList.add('active', 'text-white');
            document.getElementById('auth-btn').innerText = mode === 'login' ? 'ACCEDER AL SISTEMA' : 'CREAR CUENTA EMPRESARIAL';
            document.getElementById('auth-msg').innerText = '';
        }

        async function submitAuth() {
            const user = document.getElementById('auth-user').value;
            const pass = document.getElementById('auth-pass').value;
            const msg = document.getElementById('auth-msg');
            
            if(!user || !pass) {
                msg.innerText = "Campos obligatorios";
                msg.className = "text-center text-[10px] text-red-500 font-black uppercase";
                return;
            }

            setLoader(30);
            try {
                const res = await fetch(`${API}?action=${authMode}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: user, password: pass})
                });
                const data = await res.json();
                if(data.success) {
                    if(authMode === 'register') {
                        msg.innerText = "Registro completo. Por favor inicie sesión.";
                        msg.className = "text-center text-[10px] text-emerald-500 font-black uppercase";
                        switchAuth('login');
                    } else {
                        location.reload();
                    }
                } else {
                    msg.innerText = data.error || "Error de credenciales";
                    msg.className = "text-center text-[10px] text-red-500 font-black uppercase";
                }
            } catch(e) { msg.innerText = "Error de comunicación con API"; }
            setLoader(100);
        }

        // --- CARGA DE ARCHIVOS ---
        async function loadFiles(path = '') {
            currentPath = path;
            setLoader(40);
            updateBreadcrumb();
            const action = currentView === 'trash' ? 'list_trash' : 'list_files';
            
            try {
                const res = await fetch(`${API}?action=${action}&path=${encodeURIComponent(path)}`);
                allFiles = await res.json();
                renderFiles(allFiles);
                updateBadges();
                updateStorage();
            } catch(e) { console.error("Error al sincronizar:", e); }
            setLoader(100);
        }

        function renderFiles(files) {
            const container = document.getElementById('file-list');
            const empty = document.getElementById('empty-state');
            container.innerHTML = '';
            
            if(files.length === 0) {
                empty.classList.remove('hidden');
                return;
            }
            empty.classList.add('hidden');

            // Botón Regresar
            if(currentPath) {
                const backRow = document.createElement('div');
                backRow.className = 'file-row text-zinc-600 italic hover:text-white';
                backRow.innerHTML = `<div></div><div class="col-span-11 flex items-center gap-2"><i class="fas fa-level-up-alt"></i> .. (Carpeta Anterior)</div>`;
                backRow.onclick = () => {
                    const parts = currentPath.split('/');
                    parts.pop();
                    loadFiles(parts.join('/'));
                };
                container.appendChild(backRow);
            }

            files.forEach(f => {
                const row = document.createElement('div');
                row.className = `file-row ${selectedFiles.has(f.path) ? 'selected' : ''}`;
                row.oncontextmenu = (e) => handleContextMenu(e, f);
                
                row.onclick = (e) => {
                    if(e.ctrlKey) {
                        toggleSelect(f.path);
                    } else if(f.type === 'dir') {
                        loadFiles(f.path);
                    } else {
                        // Selección simple
                        selectedFiles.clear();
                        toggleSelect(f.path);
                    }
                };

                const icon = f.type === 'dir' ? 'fa-folder text-amber-500' : getFileIcon(f.name);
                
                row.innerHTML = `
                    <div class="flex justify-center" onclick="event.stopPropagation()">
                        <input type="checkbox" ${selectedFiles.has(f.path) ? 'checked' : ''} onchange="toggleSelect('${f.path}')" class="rounded bg-zinc-800 border-zinc-700 text-blue-600 w-3 h-3">
                    </div>
                    <div class="flex items-center gap-3 overflow-hidden">
                        <i class="fas ${icon} text-lg"></i>
                        <span class="text-sm font-semibold truncate text-zinc-200">${f.name}</span>
                    </div>
                    <div class="text-[10px] font-mono text-zinc-500">${f.type === 'dir' ? '--' : formatBytes(f.size)}</div>
                    <div class="text-[10px] font-bold text-zinc-600">${f.modified || 'Sincronizando...'}</div>
                    <div class="text-right text-zinc-800 hover:text-white transition-colors">
                        <i class="fas fa-ellipsis-v p-2" onclick="event.stopPropagation(); handleContextMenu(event, '${f.path}')"></i>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        // --- DRAG AND DROP ---
        const dz = document.getElementById('drop-zone');
        dz.addEventListener('dragover', (e) => { e.preventDefault(); dz.classList.add('drag-over'); });
        dz.addEventListener('dragleave', () => dz.classList.remove('drag-over'));
        dz.addEventListener('drop', (e) => {
            e.preventDefault();
            dz.classList.remove('drag-over');
            handleFileUpload(e.dataTransfer.files);
        });

        async function handleFileUpload(files) {
            setLoader(10);
            for(let i=0; i < files.length; i++) {
                const f = files[i];
                const base64 = await toBase64(f);
                await fetch(`${API}?action=upload_file`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({filename: f.name, content: base64, path: currentPath})
                });
                setLoader(10 + ((i+1)/files.length * 80));
            }
            loadFiles(currentPath);
        }

        // --- MENÚ CONTEXTUAL ---
        function handleContextMenu(e, fileData) {
            e.preventDefault();
            e.stopPropagation();
            
            // Si es un string (path), buscamos el objeto
            contextTarget = typeof fileData === 'string' ? allFiles.find(f => f.path === fileData) : fileData;
            
            const menu = document.getElementById('context-menu');
            const fileGroup = document.getElementById('ctx-file-group');
            const globalGroup = document.getElementById('ctx-global-group');

            if(contextTarget) {
                fileGroup.classList.remove('hidden');
                globalGroup.classList.add('hidden');
            } else {
                fileGroup.classList.add('hidden');
                globalGroup.classList.remove('hidden');
            }

            menu.style.display = 'block';
            menu.style.left = `${e.clientX}px`;
            menu.style.top = `${e.clientY}px`;
        }

        async function execAction(action) {
            if(!contextTarget) return;
            setLoader(50);
            
            switch(action) {
                case 'download':
                    window.location.href = `${API}?action=download&path=${encodeURIComponent(contextTarget.path)}`;
                    break;
                case 'delete':
                    const actionType = currentView === 'trash' ? 'delete_permanent' : 'move_to_trash';
                    await fetch(`${API}?action=${actionType}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({path: contextTarget.path})
                    });
                    loadFiles(currentPath);
                    break;
                case 'rename':
                    const newName = prompt("Nuevo nombre:", contextTarget.name);
                    if(newName && newName !== contextTarget.name) {
                        await fetch(`${API}?action=rename`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({path: contextTarget.path, newName: newName})
                        });
                        loadFiles(currentPath);
                    }
                    break;
            }
            setLoader(100);
        }

        // --- UTILS ---
        function getFileIcon(name) {
            const ext = name.split('.').pop().toLowerCase();
            const icons = {
                pdf: 'fa-file-pdf text-red-500',
                jpg: 'fa-file-image text-emerald-500', png: 'fa-file-image text-emerald-500',
                zip: 'fa-file-archive text-amber-600', rar: 'fa-file-archive text-amber-600',
                doc: 'fa-file-word text-blue-500', docx: 'fa-file-word text-blue-500',
                mp4: 'fa-file-video text-purple-500', mov: 'fa-file-video text-purple-500'
            };
            return icons[ext] || 'fa-file-alt text-zinc-400';
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024, sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        function setLoader(val) {
            const l = document.getElementById('loader');
            l.style.display = 'block';
            l.style.width = val + '%';
            if(val >= 100) setTimeout(() => { l.style.display = 'none'; l.style.width = '0'; }, 500);
        }

        function updateBreadcrumb() {
            const b = document.getElementById('breadcrumb');
            let html = `<i class="fab fa-github text-blue-500 text-sm"></i> / <span class="hover:text-white cursor-pointer" onclick="loadFiles('')">ROOT</span>`;
            if(currentPath) {
                const parts = currentPath.split('/');
                let cumulativePath = '';
                parts.forEach(p => {
                    cumulativePath += (cumulativePath ? '/' : '') + p;
                    html += ` / <span class="hover:text-white cursor-pointer" onclick="loadFiles('${cumulativePath}')">${p.toUpperCase()}</span>`;
                });
            }
            b.innerHTML = html;
        }

        function filterFiles() {
            const term = document.getElementById('file-search').value.toLowerCase();
            const filtered = allFiles.filter(f => f.name.toLowerCase().includes(term));
            renderFiles(filtered);
        }

        function setView(v) {
            currentView = v;
            selectedFiles.clear();
            document.getElementById('view-title').innerText = v === 'trash' ? 'Papelera' : 'Mi Unidad';
            document.getElementById('btn-empty-trash').classList.toggle('hidden', v !== 'trash');
            
            // Actualizar Estilos Nav
            document.getElementById('nav-files').className = v === 'files' ? 'w-full flex items-center justify-between px-4 py-3 text-sm rounded-xl bg-blue-600/10 text-blue-400 font-bold group' : 'w-full flex items-center justify-between px-4 py-3 text-sm rounded-xl text-zinc-500 hover:bg-white/5 font-medium transition-all';
            document.getElementById('nav-trash').className = v === 'trash' ? 'w-full flex items-center justify-between px-4 py-3 text-sm rounded-xl bg-red-600/10 text-red-400 font-bold' : 'w-full flex items-center justify-between px-4 py-3 text-sm rounded-xl text-zinc-500 hover:bg-white/5 font-medium transition-all';
            
            loadFiles('');
        }

        function toggleSelect(path) {
            if(selectedFiles.has(path)) selectedFiles.delete(path);
            else selectedFiles.add(path);
            
            const tb = document.getElementById('selection-toolbar');
            if(selectedFiles.size > 0) {
                tb.classList.remove('hidden');
                document.getElementById('selection-count').innerText = `${selectedFiles.size} seleccionados`;
            } else {
                tb.classList.add('hidden');
            }
            renderFiles(allFiles);
        }

        async function logout() {
            await fetch(`${API}?action=logout`);
            location.reload();
        }

        window.onclick = () => document.getElementById('context-menu').style.display = 'none';
        window.oncontextmenu = (e) => {
            if(!e.target.closest('.file-row') && !e.target.closest('.context-menu')) {
                handleContextMenu(e, null);
            }
        };

        // Inicialización
        (async () => {
            const res = await fetch(`${API}?action=check_session`);
            const data = await res.json();
            if(data.success) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('user-name').innerText = data.username;
                document.getElementById('user-avatar').innerText = data.username[0].toUpperCase();
                loadFiles();
            }
        })();
    </script>
</body>
</html>